

<!DOCTYPE html>
<html>

<head>
  <title>Arco Research &amp; Documentation</title>
  <meta charset='utf-8'>

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <link rel="stylesheet" href="/css/highlight-default.css">
  <link rel="stylesheet" href="/css/style.css">

  <link rel="icon" type="image/png"  href="/images/icon.png">
</head>

<body>
  <div id="content" class="container" style="padding-top: 15px">


<link rel="stylesheet" href="/shapes/css/style.css">

<div class="box">
  <a href="/">
    <img src="/shapes/images/shapes-logo.png"
         style="padding: 0 25px" />
  </a>
  <h1 style="display: inline; font-weight: bold; font-size: 2.3em; padding-top: 10px">
    <a href="/shapes" style="color: inherit">Shapes</a>
  </h1>
</div>

<hr style="border: 1px solid #333333">


<h1>Manage your Smart Mirror with smartmirror-console</h1>
<nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#ingredients">Ingredients</a></li>
    <li><a href="#start-the-environment">Start the environment</a></li>
    <li><a href="#modules">Modules</a>
      <ul>
        <li><a href="#mi-band-4-data-collector">Mi Band 4 Data Collector</a></li>
      </ul>
    </li>
    <li><a href="#resources-and-useful-links">Resources and useful links</a></li>
    <li><a href="#appendix-1-manual-installation-of-postgresql">Appendix 1. Manual installation of PostgreSQL</a></li>
    <li><a href="#appendix-2-configure-mi-band-4-devices-with-mi-fit-application">Appendix 2. Configure Mi Band 4 devices with Mi Fit application</a></li>
  </ul>
</nav>

<div class="recipe-content">
  <h2 id="overview">Overview</h2>
<p>A <em>Smart Mirror</em> can be overloaded with multiple services and utilities to serve different functionalities, but, like any other software product, this have to be shaped into its final user needs. For that, the <code>smartmirror-console</code> comes in handy, as it provides a <strong>high-level</strong> interface to configure all <em>Smart Mirror</em> packages and services.</p>
<h2 id="ingredients">Ingredients</h2>
<p>The mandatory ingredients to follow this recipe are:</p>
<ul>
<li>A PC with a browser installed.</li>
<li>A Raspberry Pi 4, or <strong>RPi4</strong>, either connected to the same network as the PC, or with a public ID address.</li>
<li>The package <code>smartmirror-console</code> installed on your RPi4, which is available in <a href="https://uclm-arco.github.io/debian/">ARCO package repository</a>. Be sure it has the version <code>0.20210510+ds.1</code> or higher.</li>
</ul>
<h2 id="start-the-environment">Start the environment</h2>
<p>To access the console, open the PC browser and write the RPi4 address, its IP address or a public one if it has any. It is required to specifiy the port to access to, which is 5000. This is done by preciding the port number with a colon.</p>
<p>For example, if the RPi4 has the address <em><code>my-smartmirror.com</code></em>, the console address will be <em><code>http://my-smartmirror.com:5000</code></em>.</p>
<p>Then, a login page will be shown. Credentials will be <em>admin</em> for both username and password for the first time using the application, followed by other form asking to change the default password. So, from that point, username will remain as <em>admin</em>, but it will be used the new setted password, so be sure to remember that password!</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/login.png' width='900px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<p>After logged in, it will appear the main page, where all available and configurable modules will be shown. There is only one module available right now, which is the <strong>Mi Band 4 Data Collector</strong>. This one, and further added modules, will be explained in the following sections.</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/home.png' width='900px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<h2 id="modules">Modules</h2>
<p>In this section it will be explained how to configure each one of the <em>Smart Mirror</em> modules.</p>
<h3 id="mi-band-4-data-collector">Mi Band 4 Data Collector</h3>
<p>This section explains how to configure the <em>Mi Band 4 Data Collector</em> module, that refers to <code>miband-dc</code> debian package.</p>
<p>It can also be managed using its <strong>low-level</strong> interface, through configuration files. To know more about this, read <code>miband-dc</code> manual page or <a href="https://arcogroup.bitbucket.io/shapes/integrating_miband_with_smart_mirror/#configuring-miband-dc"><em>Configuring <code>miband-dc</code></em> section at Integrating Xiaomi Mi Band 4 devices with <em>Smart Mirror</em></a>.</p>
<h4 id="ingredients-1">Ingredients</h4>
<p>The specific ingredients to complete the steps detailed in this section are:</p>
<ul>
<li>If <em>Mi Band 4 Data Collector</em> is not installed, do it through <code>smartmirror-console</code> interface.</li>
<li>A <a href="https://www.postgresql.org/">PostgreSQL</a> database with remote connections allowed, either by using a provider on the cloud, or by doing a manual installation. If the latter is chosen, please read <a href="#appendix-1-manual-installation-of-postgresql">Appendix 1</a>.</li>
<li>Mi Fit application installed on a mobile device (<a href="https://play.google.com/store/apps/details?id=com.xiaomi.hm.health&amp;hl=es&amp;gl=US">Android</a> or <a href="https://apps.apple.com/es/app/mi-fit/id938688461">iOS</a>).</li>
<li>One or more <a href="https://www.mi.com/es/mi-smart-band-4/">Mi Smart Band 4</a> devices, or <strong>MB4</strong>.</li>
</ul>
<h4 id="settings">Settings</h4>
<p>Go to the settings page of the <em>Mi Band 4 Data Collector</em>, in which there is a side menu displaying settings sections. Also, at the top of the page we can see the version of the package and several buttons which change the package status: start or stop collecting, install or uninstall the package, and inspect the service (show logs).</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/miband-dc-header.png' width='700px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<p>Let&rsquo;s review each one of the settings sections.</p>
<h5 id="database-parameters">Database parameters</h5>
<p>The data collector stores all information collected in a database. In order to use it, please complete the form with its connection parameters and click &ldquo;Save&rdquo; button.</p>

  
  





<div class="alert alert-warning" role="alert">
  <h4 class="alert-heading">
    
      Warning!
    
  </h4>
  <hr class="separator"><div class="alert-body">
    This configuration is <strong>mandatory</strong> for the <em>Mi Band 4 Data Collector</em> to run properly. Also, the console <strong>does not test</strong> the connection to the database.
  </div>
</div>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/miband-dc-database.png' width='900px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<h5 id="notifications">Notifications</h5>
<p>The service <code>miband-dc</code>, the data collector, can notify the user, if the user wants to, about some internal information. This can be done by setting an e-mail address and a time interval. This data will be stored by the console, but, if selected, used by the data collector. To enable a notification, select the desired notification types and click &ldquo;Save&rdquo;.</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/miband-dc-notifications.png' width='900px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<h5 id="hooks">Hooks</h5>
<p>This service can be linked with <a href="https://magicmirror.builders/">Magic Mirror</a>, <code>magic-mirror-2</code> package, through its modules. To do so, make sure you have installed the aforementioned package and the required modules for each hook. To enable a hook, just select it and click &ldquo;Save&rdquo;.</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/miband-dc-hooks.png' width='900px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<h5 id="charging-station">Charging station</h5>
<p>To ease the data updating process, the data collector can perform, if configured, as a charging station. This mode pretends to simulate an <em>updating station</em>, where users leave their devices charging while data is being stored, resulting in a less aggressive communication. To enable it, select the option and click &ldquo;Save&rdquo;.</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/miband-dc-charging-station.png' width='900px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<h5 id="devices">Devices</h5>
<p>In order to pair your MB4 devices with the data collector, you must link them to a Mi Fit account. To do so, follow the steps of <a href="#appendix-2-configure-mi-band-4-devices-with-mi-fit-application">Appendix 2</a>.</p>
<p>To add all linked MB4, go to the <em>Getting tokens</em> section. Fill the form with your credentials and click &ldquo;Request tokens&rdquo;. After some time, a list containing your devices data will appear. Finally, click &ldquo;Add all and save&rdquo;.</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/miband-dc-devices-getting-tokens.png' width='600px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>


<p>Also, you can manually add a device to the data collector providing a MAC address and an authentication token. Click on the &ldquo;Add&rdquo; button, with a &ldquo;plus&rdquo; icon, to add a new device. After providing the required information, click &ldquo;Save&rdquo;.</p>

  
  



  
  





  
    
  
  
    
  
  
    
  



  



<img src='/shapes/images/smartmirror_console_manual/miband-dc-devices-manual.png' width='600px' height=''style='display: block;margin-right: auto;margin-left: auto;max-width: 100%;'/>



  
  





<div class="alert alert-warning" role="alert">
  <h4 class="alert-heading">
    
      Warning!
    
  </h4>
  <hr class="separator"><div class="alert-body">
    The console <strong>does not check</strong> the validity of a band token. To know if communication is correct, see data collector logs by clicking the &ldquo;Inspect&rdquo; button.
  </div>
</div>
<h2 id="resources-and-useful-links">Resources and useful links</h2>
<ul>
<li><a href="https://arcogroup.bitbucket.io/shapes/integrating_miband_with_smart_mirror/">Integrating Xiaomi Mi Band 4 devices with <em>Smart Mirror</em></a></li>
<li><a href="https://magicmirror.builders/">Magic Mirror</a></li>
<li><code>miband-dc</code> manual page</li>
<li>Mi Fit application (<a href="https://play.google.com/store/apps/details?id=com.xiaomi.hm.health&amp;hl=es&amp;gl=US">Android</a> or <a href="https://apps.apple.com/es/app/mi-fit/id938688461">iOS</a>)</li>
<li><a href="https://www.mi.com/es/mi-smart-band-4/">Mi Smart Band 4</a></li>
<li><a href="https://www.postgresql.org/">PostgreSQL</a></li>
</ul>
<h2 id="appendix-1-manual-installation-of-postgresql">Appendix 1. Manual installation of PostgreSQL</h2>
<p>Install PostgreSQL following <a href="https://www.postgresql.org/download/">its instructions</a>. Then, you need to modify two configuration files: <code>postgresql.conf</code> and <code>pg_hba.conf</code>.</p>
<p>The first one, <code>postgresql.conf</code>, can be found by executing <code>SHOW config_file</code> with the PostgreSQL client <code>psql</code>. Once found, modify the parameter <a href="https://www.postgresql.org/docs/12/runtime-config-connection.html#GUC-LISTEN-ADDRESSES">listen_addresses</a> to *. If the line containing this parameter is preceded by a hashtag, remember to delete this character. For example, in a Linux environment:</p>
<div class="app-skin shell">
  <div class="filename">console</div>
  
  <pre class=shell>user@linux:~/$ sudo su postgres -c &#34;psql -c &#39;SHOW config_file&#39;&#34;
               config_file               
-----------------------------------------
 /etc/postgresql/12/main/postgresql.conf
(1 row)

user@linux:~/$ [ ... modify file ... ]
user@linux:~/$ sudo grep -n listen_addresses /etc/postgresql/12/main/postgresql.conf 
59:listen_addresses = &#39;*&#39;</pre>
</div>
<p>The second configuration file, <code>pg_hba.conf</code>, can be found searching for the parameter <a href="https://www.postgresql.org/docs/12/runtime-config-file-locations.html#GUC-HBA-FILE">hba_file</a> in the first one, <code>postgresql.conf</code>. Once found, and following <a href="https://www.postgresql.org/docs/12/auth-pg-hba-conf.html">this file format</a>, add the following lines:</p>
<div class="app-skin">
  <div class="filename">
    
      snippet.conf
    
  </div>
  
  <pre><code class='language-conf'># TYPE  DATABASE        USER            ADDRESS                 METHOD
host    database        user            samenet                 md5</code></pre>
</div>
<p>Replace <em>database</em> and <em>user</em> with its respective values for the data collector. Both values are <em>miband-dc</em> in this recipe, section <a href="#database-parameters">Database parameters</a>. Also, replace <em>samenet</em> with your PostgreSQL host public IP address if it is not running on the same network as the RPi4 with the data collector.</p>
<h2 id="appendix-2-configure-mi-band-4-devices-with-mi-fit-application">Appendix 2. Configure Mi Band 4 devices with Mi Fit application</h2>
<p>First, create an account for Mi Fit application and log in.</p>

  
  





<div class="alert alert-warning" role="alert">
  <h4 class="alert-heading">
    
      Warning!
    
  </h4>
  <hr class="separator"><div class="alert-body">
    It is required a &ldquo;recent&rdquo; Mi Fit account to follow further steps. If you are not sure about when your account was created, it is highly recommended that you create a new one.
  </div>
</div>
<p>Link the devices following the manufacturer instructions. If you add multiple devices, you will be asked to &ldquo;deactivate&rdquo; your previous band, as there cannot be two active devices of the same type. Ignore this warning, as it is only important to link the device with the account, not the &ldquo;active&rdquo; state.</p>
<p>Each time you add a new device, go to <em>Profile &gt; My devices &gt; Active band &gt; Heart rate monitoring</em> and set:</p>
<ol>
<li>Monitoring method to <em>Automatic heart rate monitoring and sleep assistant</em>.</li>
<li>Detection frequency to less or equal than 10 minutes.</li>
<li>Enable <em>Activity monitoring</em>.</li>
</ol>
<p>Once done, it is important to turn off the Bluetooth of the mobile phone you used to activate the band, as it will interfere with the communication between the data collector and the active band. If you need to enable the Bluetooth, just make sure that you place the MB4 far away, if possible.</p>

</div>



    </div> 

    <footer class="footer">
      <div class="container text-center">
        <a href="http://www.arcoresearch.com">ARCO Research Group</a> |
        <a href="/">Docs</a>&nbsp; - &nbsp;made with
        <a href="https://gohugo.io">Hugo</a> ·
        <a href="http://getbootstrap.com">Bootstrap</a>
      </div>
    </footer>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>


