

<!DOCTYPE html>
<html>

<head>
  <title>Arco Research &amp; Documentation</title>
  <meta charset='utf-8'>

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <link rel="stylesheet" href="/css/highlight-default.css">
  <link rel="stylesheet" href="/css/style.css">

  <link rel="icon" type="image/png"  href="/images/icon.png">
</head>

<body>
  <div id="content" class="container" style="padding-top: 15px">


<link rel="stylesheet" href="/recipes/css/style.css">

<div class="box">
  <a href="/">
    <img src="/images/arco-logo-128.png"
         style="padding: 0 25px" />
  </a>
  <h1 style="display: inline; font-weight: bold; font-size: 2.3em; padding-top: 10px">
    <a href="/recipes" style="color: inherit">Arco Recipes</a>
  </h1>
</div>

<hr style="border: 1px solid #333333">


<h1>Cómo crear snapshots de vagrant</h1>
<nav id="TableOfContents"></nav>

<div class="recipe-content">
  <h1 id="ingredientes">Ingredientes</h1>
<p>Esta receta está pensada para ser usada con un demostrador o servicio que está virtualizado usando <a href="https://www.vagrantup.com/">Vagrant</a>. Partiremos asumiendo que el servicio está correctamente desplegado y funcionando.</p>
<h1 id="crear-el-box-de-vagrant">Crear el <code>box</code> de vagrant</h1>
<p>Para crear el <em>box</em>, solo es necesario ejecutar el siguiente comando:</p>
<div class="app-skin shell">
  <div class="filename">console</div>
  
  <pre class=shell>$ vagrant package --output my-application.box</pre>
</div>
<p>Esto generará un fichero con el nombre indicado, que podrá ser usado para <strong>crear nuevas instancias</strong> de este Vagrant. El fichero contiene el sistema entero tal y como esta en este momento, por lo que quizá ocupe más de 1 GiB (dependiendo del contenido de la VM).</p>
<p>Crea una carpeta en algún sitio, y ponle como nombre la fecha de hoy. Utilizaremos esa carpeta para guardar todo lo relacionado con esta instantánea. Mueve el <code>.box</code> a esa carpeta:</p>
<div class="app-skin shell">
  <div class="filename">console</div>
  
  <pre class=shell>$ mkdir 20190823
$ mv my-application.box 20190823</pre>
</div>
<p>Ahora necesitarás <strong>incluir</strong> el <code>Vagrantfile</code>: cópialo en la carpeta que has creado. Y dado que el despliegue ya está hecho dentro de la VM, es necesario que <strong>comentes</strong> (o borres) las líneas relacionadas. En mi caso:</p>
<div class="app-skin">
  <div class="filename">
    
      Vagrantfile
    
  </div>
  
  <pre><code class='language-rb'>...
# config.vm.provision :ansible, playbook: &#34;provision.yaml&#34;
...</code></pre>
</div>
<p>También deberás cambiar la <strong>configuración relativa al box</strong> que vas a emplear. Debes indicarle que será el que hay en esta misma carpeta (y que acabas de crear). Para ello, edita la siguiente línea (usa el nombre de tu <code>.box</code>):</p>
<div class="app-skin">
  <div class="filename">
    
      Vagrantfile
    
  </div>
  
  <pre><code class='language-rb'>config.vm.box = &#34;my-application.box&#34;</code></pre>
</div>
<h1 id="reunir-las-dependencias">Reunir las dependencias</h1>
<p>Si bien es cierto que esta máquina no necesita despliegue, es probable que tengas algún <strong>fichero compartido</strong> en el host. Por ello, asegúrate de copiar al directorio donde está el <code>Vagrantfile</code> todos aquellos ficheros que necesites. Por ejemplo, si mi maquina necesita un fichero llamado <code>Makefile</code>, que asumo que se montará en <code>/vagrant</code> automáticamente, es necesario que lo copie al directorio destino:</p>
<div class="app-skin shell">
  <div class="filename">console</div>
  
  <pre class=shell>$ cp Makefile 20190823</pre>
</div>
<p>Por otro lado, verifica que haces lo mismo con aquellas <strong>carpetas</strong> que se han <strong>compartido de forma explícita</strong>. Por ejemplo, si tienes un <code>synced_folder &quot;src&quot;</code> en tu <code>Vagrantfile</code>, copia ese directorio también (y si la ruta era relativa y en niveles superiores, actualiza el <code>Vagrantfile</code> como veas apropiado)</p>
<p>Una vez hecho esto, <strong>comprueba que todo funciona</strong> correctamente arrancando la máquina desde el directorio que has creado, y verificando que los servicios / dependencias se cumplen.</p>
<h1 id="indicar-que-el-servicio-tiene-snapshots">Indicar que el servicio tiene <em>snapshots</em></h1>
<p>Lo siguiente que debes hacer es <strong>guardar el directorio</strong> que has creado en algún sitio accesible. De esa forma, estará disponible cuando haga falta. Y por último, debes indicar que este servicio está <strong>disponible en una instantánea</strong>. Para ello, añade al repositorio el siguiente fichero, y modifícalo para incluir la ruta adecuada:</p>
<div class="app-skin">
  <div class="filename">
    
      SNAPSHOTED
    
  </div>
  
  <pre><code class='language-txt'>This repository (with its deployed services on Vagrant) has been SNAPSHOTED,
which means that there are one or more images with an already deployed state.
The goal of this is to get an always-running system, despite software updates or
source changes.

Please, see the following location to get the snapshots:

* ssh://arco.esi.uclm.es/users/oscar.acena/time-machine/my-application</code></pre>
</div>
<h1 id="referencias">Referencias</h1>
<ul>
<li><a href="https://www.vagrantup.com/docs/virtualbox/boxes.html">Vagrant: Creating a Base Box</a></li>
</ul>

</div>



    </div> 

    <footer class="footer">
      <div class="container text-center">
        <a href="http://www.arcoresearch.com">ARCO Research Group</a> |
        <a href="/">Docs</a>&nbsp; - &nbsp;made with
        <a href="https://gohugo.io">Hugo</a> ·
        <a href="http://getbootstrap.com">Bootstrap</a>
      </div>
    </footer>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>


